name: Tests JUnit Automatiques

# DÃ©clenche le workflow Ã  chaque push et pull request
on:
  push:
    branches: [ main, master, develop ]
  pull_request:
    branches: [ main, master ]

jobs:
  test:
    name: Compilation et Tests
    runs-on: ubuntu-latest

    steps:
    # Ã‰tape 1 : RÃ©cupÃ©rer le code du repository
    - name: ğŸ“¥ Checkout du code
      uses: actions/checkout@v4

    # Ã‰tape 2 : Installer Java 17
    - name: â˜• Installation de Java 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: maven

    # Ã‰tape 3 : Afficher les versions (pour debug)
    - name: ğŸ” VÃ©rification des versions
      run: |
        java -version
        mvn --version

    # Ã‰tape 4 : Compiler le projet
    - name: ğŸ”¨ Compilation du projet
      run: mvn clean compile

    # Ã‰tape 5 : ExÃ©cuter les tests JUnit
    - name: ğŸ§ª ExÃ©cution des tests JUnit
      run: mvn test

    # Ã‰tape 6 : GÃ©nÃ©rer le rapport de couverture
    - name: ğŸ“Š GÃ©nÃ©ration du rapport de couverture
      run: mvn jacoco:report

    # Ã‰tape 7 : Publier les rÃ©sultats des tests
    - name: ğŸ“¤ Publication des rÃ©sultats
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: rapports-tests
        path: |
          target/surefire-reports/
          target/site/jacoco/

    # Ã‰tape 8 : Afficher un rÃ©sumÃ©
    - name: âœ… RÃ©sumÃ© des tests
      if: success()
      run: echo "âœ… Tous les tests sont passÃ©s avec succÃ¨s !"

    - name: âŒ Ã‰chec des tests
      if: failure()
      run: echo "âŒ Certains tests ont Ã©chouÃ©. VÃ©rifie les logs ci-dessus."